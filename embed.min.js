!async function(){function t(t){if(window.Chart&&window.ChartDataLabels){t();return}let e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/chart.js",e.onload=()=>{let e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels",e.onload=()=>{t()},document.head.appendChild(e)},document.head.appendChild(e);let a=document.createElement("link");a.rel="stylesheet",a.href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css",document.head.appendChild(a);let s=document.createElement("link");s.href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap",s.rel="stylesheet",document.head.appendChild(s)}let e={C1:5,C2:4,C3:3,C4:2,C5:1},a={5:"Top 0.01%",4:"Top 0.1%",3:"Top 1%",2:"Top 10%",1:"Average"},s={5:"#00441b",4:"#1b7837",3:"#4daf4a",2:"#a6d96a",1:"#808080"};function o(t){return s[t]||"#81c784"}async function i(t){return e[t]||null}async function n(t){try{let e=encodeURIComponent(t),a=await fetch(`https://bip-api.imsi.athenarc.gr/paper/scores/${e}`);if(!a.ok)throw Error("API request failed");let s=await a.json();return{...s,imp_class:await i(s.imp_class),inf_class:await i(s.inf_class),pop_class:await i(s.pop_class),cc_class:await i(s.cc_class)}}catch(o){return console.error("Error fetching score:",o),null}}function l(t,e){if(!function t(){if(document.getElementById("doughnut-chart-styles"))return;let e=document.createElement("style");e.id="doughnut-chart-styles",e.innerHTML=`
    .popup-tooltip *{
      font-family: 'Nunito', sans-serif !important;
    } 
    
    .popup-tooltip {
      display: none;
      position: absolute;
      top: 37px;
      left: 74px;
      background: #f8f9fa;
      transform: translateY(-50%);
      border: 1px solid #ccc;
      padding: 13px;
      border-radius: 5px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      z-index: 999;
      min-width: 180px;
      color: #333;
      line-height: 1.5;
      font-size: 14px;
      font-family: 'Nunito', sans-serif;
      white-space: nowrap;
    }

    .popup-tooltip.show {
      display: block;
      opacity: 1;
    }

    .popup-row { display: flex; justify-content: space-between; align-items: center; }
    .popup-val { display: inline-flex; align-items: center; gap: 14px; }
    .popup-val > strong { min-width: 90px; text-align: right; }
    .popup-val .score { color: #808080; font-size: 12px; min-width: 80px; text-align: right; }
    .popup-header { display:flex; justify-content: space-between; align-items:center; font-weight:600; margin-bottom:6px; color: #808080; }
    .popup-header .col-class { min-width: 90px; text-align: right; }
    .popup-header .col-score { min-width: 80px; text-align: right; }
    .popup-row > span:first-child { color: #808080; }


    .popup-tooltip i {
      color: #808080;
      margin-right: 8px;
      font-size: 16px;
      font-family: 'Font Awesome 6 Free' !important;
      font-weight: 900;
    }

    .popup-tooltip a {
      display: inline-block;
      margin-top: 12px;
      color: #808080;
      font-weight: 600;
      text-decoration: none;
      transition: color 0.2s;
    }

    .popup-tooltip a:hover {
      color: #2e7d32;
      text-decoration: underline;
    }
  `,document.head.appendChild(e)}(),!e){t.innerHTML="",t.style="";return}t.style.position="relative",t.style.display="inline-block",t.style.cursor="pointer",t.style.margin="10px",t.innerHTML=`<div class="chart-container" style="position: relative; margin: auto;">
    <canvas id="chart-${e.doi.replace(/[^a-z0-9]/gi,"_")}-doughnut" width="400" height="400"></canvas>
    <div class="popup-tooltip" id="chartTooltip-${e.doi.replace(/[^a-z0-9]/gi,"_")}">
    <div class="popup-header">
      <span>Indicator</span>
      <span class="popup-val"><span class="col-class">Class</span><span class="col-score">Score</span></span>
    </div>
    <div class="popup-row"><span><i class="fa-solid fa-fire"></i> Popularity</span>
  <span class="popup-val">
    <strong style="color: ${o(e?.pop_class)};">${a[e?.pop_class]}</strong>
    <span class="score">${e?.attrank?e.attrank:""}</span>
  </span>
</div>
<div class="popup-row"><span><i class="fa-solid fa-landmark"></i> Influence</span>
  <span class="popup-val">
    <strong style="color: ${o(e?.inf_class)};">${a[e?.inf_class]}</strong>
    <span class="score">${e?.pagerank?e.pagerank:""}</span>
  </span>
</div>
<div class="popup-row"><span><i class="fa-solid fa-quote-left"></i> Citation Count</span>
  <span class="popup-val">
    <strong style="color: ${o(e?.cc_class)};">${a[e?.cc_class]}</strong>
    <span class="score">${e?.cc?e.cc:""}</span>
  </span>
</div>
<div class="popup-row"><span><i class="fa-solid fa-rocket"></i> Impulse</span>
  <span class="popup-val">
    <strong style="color: ${o(e?.imp_class)};">${a[e?.imp_class]}</strong>
    <span class="score">${e?.["3_year_cc"]??""}</span>
  </span>
</div>
    </div>
  </div>`,t.style.width="64px",t.style.height="64px";let s=t.querySelector(`#chart-${e.doi.replace(/[^a-z0-9]/gi,"_")}-doughnut`),i=t.querySelector(`#chartTooltip-${e.doi.replace(/[^a-z0-9]/gi,"_")}`),n={labels:["Popularity","Influence","Citation","Impulse"],datasets:[{data:(()=>{let t=[],a=e=>{1===e?t.push(0,5,.1):t.push(e,5-e,.1)};return a(e?.inf_class),a(e?.cc_class),a(e?.imp_class),a(e?.pop_class),t})(),backgroundColor:(()=>{let t=[],a=e=>{t.push(o(e),"#e0e0e0","transparent")};return a(e?.inf_class),a(e?.cc_class),a(e?.imp_class),a(e?.pop_class),t})(),borderWidth:0,borderColor:"#fff",cutout:"55%"},]},l={type:"doughnut",data:n,options:{plugins:{datalabels:{display:!1},legend:{display:!1},tooltip:{enabled:!1}}},plugins:[ChartDataLabels,{id:"centerIcons",afterDraw(t){let{ctx:e,chartArea:a}=t,s=(a.left+a.right)/2,o=(a.top+a.bottom)/2,i=t.data.datasets[0],n=i.cutout?parseFloat(i.cutout)/100:.55,l=Math.min(a.width,a.height)/2*(1+n)/2/2.5,p=["","","",""];e.save(),e.font="10px FontAwesome",e.fillStyle="#808080",e.textAlign="center",e.textBaseline="middle";for(let r=0;r<4;r++){let c=-Math.PI/2+r*(Math.PI/2);c+=Math.PI/4;let d=s+l*Math.cos(c),u=o+l*Math.sin(c);e.fillText(p[r],d,u)}e.restore()}},]};new Chart(s,l),t.addEventListener("mouseenter",()=>i.classList.add("show")),t.addEventListener("mouseleave",()=>i.classList.remove("show")),s.addEventListener("click",()=>window.open(`https://bip.imsi.athenarc.gr/site/details?id=${e.doi}`,"_blank"))}function p(t){t.innerHTML=`
      <span class="loader"></span>
      <style>
        .loader {
            width: 48px;
            height: 48px;
            border: 3px dotted #00441b;
            border-style: solid solid dotted dotted;
            border-radius: 50%;
            display: inline-block;
            position: relative;
            box-sizing: border-box;
            animation: rotation 2s linear infinite;
          }
          .loader::after {
            content: '';  
            box-sizing: border-box;
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            margin: auto;
            border: 3px dotted #1b7837;
            border-style: solid solid dotted;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            animation: rotationBack 1s linear infinite;
            transform-origin: center center;
          }
              
          @keyframes rotation {
            0% {
              transform: rotate(0deg);
            }
            100% {
              transform: rotate(360deg);
            }
          } 
          @keyframes rotationBack {
            0% {
              transform: rotate(0deg);
            }
            100% {
              transform: rotate(-360deg);
            }
          } 
      </style>
    `,t.style.display="inline-block",t.style.width="64px",t.style.height="64px",t.style.margin="10px"}async function r(){let t=document.querySelectorAll(".bip-embed");for(let e of t){let a=e.getAttribute("data-doi");if(!a)continue;p(e);let s=await n(a);l(e,s)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>t(r)):t(r)}();